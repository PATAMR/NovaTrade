<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NovaTrade Pro v10.2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lightweight-charts@4.1.1/dist/lightweight-charts.standalone.production.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f1115;
            color: #cfd3da;
        }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Scrollbar sombre */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #13161a; }
        ::-webkit-scrollbar-thumb { background: #2d333b; border-radius: 3px; }
        
        .glass-header {
            background: rgba(19, 22, 26, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #2d333b;
        }

        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4); }
            70% { box-shadow: 0 0 0 6px rgba(34, 197, 94, 0); }
            100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
        }
        .live-indicator { animation: pulse-green 2s infinite; }
        
        /* Classe utilitaire pour le bouton actif */
        .btn-timeframe-active {
            background-color: #374151;
            color: white;
            font-weight: 700;
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body class="flex flex-col h-screen overflow-hidden text-sm">

    <!-- 1. BARRE DES MARCHÉS -->
    <div class="bg-black text-gray-500 text-[10px] py-1 px-4 flex justify-center space-x-8 border-b border-gray-800 font-mono uppercase z-30">
        <span class="flex items-center gap-2"><i class="ph-fill ph-clock"></i> NY: <span class="text-green-500" id="time-ny">--:--</span></span>
        <span class="flex items-center gap-2"><i class="ph-fill ph-clock"></i> LON: <span class="text-yellow-500" id="time-london">--:--</span></span>
        <span class="flex items-center gap-2"><i class="ph-fill ph-clock"></i> TOK: <span class="text-gray-400" id="time-tokyo">--:--</span></span>
    </div>

    <!-- 2. HEADER -->
    <header class="glass-header h-14 flex items-center justify-between px-4 shrink-0 z-20">
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-blue-600 rounded flex items-center justify-center shadow-lg">
                <i class="ph-bold ph-chart-polar text-white text-xl"></i>
            </div>
            <div class="leading-tight">
                <h1 class="font-bold text-white">NovaTrade <span class="text-blue-500">Pro</span></h1>
                <span class="text-[10px] text-gray-500 font-mono">v10.2 Extended</span>
            </div>
        </div>
        <div class="flex items-center gap-4">
            <button class="bg-blue-600 hover:bg-blue-500 text-white px-4 py-1.5 rounded text-xs font-bold transition flex items-center gap-2">
                <i class="ph-bold ph-user"></i> Se connecter
            </button>
        </div>
    </header>

    <!-- MAIN LAYOUT -->
    <div class="flex flex-1 overflow-hidden">

        <!-- 3. SIDEBAR GAUCHE (Actifs) -->
        <aside class="w-64 bg-[#13161a] border-r border-gray-800 flex flex-col shrink-0 z-10">
            <!-- Onglets -->
            <div class="flex border-b border-gray-800 text-xs">
                <button class="flex-1 py-3 text-blue-400 border-b-2 border-blue-500 bg-[#1a1d24]">Crypto</button>
                <button class="flex-1 py-3 text-gray-500 hover:text-gray-300">Actions</button>
                <button class="flex-1 py-3 text-gray-500 hover:text-gray-300">Matières</button>
            </div>

            <!-- Liste -->
            <div class="overflow-y-auto flex-1 p-2 space-y-1">
                <div class="text-[10px] font-bold text-gray-600 uppercase px-2 mt-2 mb-1">Crypto</div>
                <!-- BTC -->
                <div class="p-2 rounded bg-[#2d333b] border border-blue-500/30 flex justify-between items-center cursor-pointer">
                    <div class="flex items-center gap-2">
                        <i class="ph-fill ph-currency-btc text-orange-500 text-lg"></i>
                        <div>
                            <div class="text-white font-bold text-xs">BTC</div>
                            <div class="text-[9px] text-gray-500">Bitcoin</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-white font-mono text-xs" id="sidebar-price">25,432.10</div>
                        <div class="text-green-500 text-[10px]">+2.45%</div>
                    </div>
                </div>
                <!-- ETH -->
                <div class="p-2 rounded hover:bg-[#1e2229] flex justify-between items-center cursor-pointer text-gray-400">
                    <div class="flex items-center gap-2">
                        <i class="ph-fill ph-currency-eth text-indigo-400 text-lg"></i>
                        <div><div class="text-xs font-medium">ETH</div><div class="text-[9px]">Ethereum</div></div>
                    </div>
                    <div class="text-right"><div class="font-mono text-xs">1,654.20</div><div class="text-green-500 text-[10px]">+1.2%</div></div>
                </div>
                <!-- SOL -->
                <div class="p-2 rounded hover:bg-[#1e2229] flex justify-between items-center cursor-pointer text-gray-400">
                    <div class="flex items-center gap-2">
                        <div class="w-4 h-4 bg-purple-600 rounded-full flex items-center justify-center text-[8px] text-white">S</div>
                        <div><div class="text-xs font-medium">SOL</div><div class="text-[9px]">Solana</div></div>
                    </div>
                    <div class="text-right"><div class="font-mono text-xs">23.45</div><div class="text-red-500 text-[10px]">-0.4%</div></div>
                </div>

                <div class="h-px bg-gray-800 my-2"></div>
                <div class="text-[10px] font-bold text-gray-600 uppercase px-2 mb-1">Actions</div>
                <!-- AAPL -->
                <div class="p-2 rounded hover:bg-[#1e2229] flex justify-between items-center cursor-pointer text-gray-400">
                    <div class="flex items-center gap-2">
                        <i class="ph-fill ph-apple-logo text-gray-300 text-lg"></i>
                        <div><div class="text-xs font-medium">AAPL</div></div>
                    </div>
                    <div class="font-mono text-xs">178.35 <span class="text-green-500 text-[9px]">+0.5%</span></div>
                </div>
                <!-- TSLA -->
                <div class="p-2 rounded hover:bg-[#1e2229] flex justify-between items-center cursor-pointer text-gray-400">
                    <div class="flex items-center gap-2">
                        <i class="ph-fill ph-car text-red-500 text-lg"></i>
                        <div><div class="text-xs font-medium">TSLA</div></div>
                    </div>
                    <div class="font-mono text-xs">245.50 <span class="text-green-500 text-[9px]">+3.2%</span></div>
                </div>
            </div>
        </aside>

        <!-- 4. CHART AREA -->
        <main class="flex-1 flex flex-col bg-[#0f1115] relative min-w-0">
            <!-- Toolbar -->
            <div class="h-12 border-b border-gray-800 flex items-center justify-between px-4 bg-[#13161a]">
                <div class="flex items-center gap-4">
                    <div class="flex items-center gap-2">
                        <i class="ph-fill ph-currency-btc text-orange-500 text-xl"></i>
                        <span class="text-white font-bold">BTC/USD</span>
                    </div>
                    <!-- Timeframes (FONCTIONNELS) -->
                    <div class="flex bg-[#1a1d24] rounded p-0.5 border border-gray-800" id="timeframe-container">
                        <button onclick="updateTimeframe('1D', this)" class="px-3 py-1 text-[10px] text-gray-400 hover:bg-gray-700 rounded transition btn-timeframe-active">1J</button>
                        <button onclick="updateTimeframe('1W', this)" class="px-3 py-1 text-[10px] text-gray-400 hover:bg-gray-700 rounded transition">1S</button>
                        <button onclick="updateTimeframe('1M', this)" class="px-3 py-1 text-[10px] text-gray-400 hover:bg-gray-700 rounded transition">1M</button>
                        <button onclick="updateTimeframe('3M', this)" class="px-3 py-1 text-[10px] text-gray-400 hover:bg-gray-700 rounded transition">3M</button>
                        <button onclick="updateTimeframe('1Y', this)" class="px-3 py-1 text-[10px] text-gray-400 hover:bg-gray-700 rounded transition">1AN</button>
                        <button onclick="updateTimeframe('5Y', this)" class="px-3 py-1 text-[10px] text-gray-400 hover:bg-gray-700 rounded transition">5AN</button>
                        <button onclick="updateTimeframe('MAX', this)" class="px-3 py-1 text-[10px] text-gray-400 hover:bg-gray-700 rounded transition">MAX</button>
                    </div>
                </div>
                <!-- OHLC Display -->
                <div class="hidden lg:flex gap-4 font-mono text-[10px] text-gray-500">
                    <span>O: <span id="ohlc-open" class="text-white">-</span></span>
                    <span>H: <span id="ohlc-high" class="text-white">-</span></span>
                    <span>L: <span id="ohlc-low" class="text-white">-</span></span>
                    <span>C: <span id="ohlc-close" class="text-white">-</span></span>
                </div>
            </div>

            <!-- Chart -->
            <div class="relative w-full h-full">
                <div id="chart-container" class="w-full h-full"></div>
                <div id="legend" class="absolute top-3 left-3 z-10 bg-black/60 backdrop-blur px-2 py-1 rounded text-xs font-mono hidden pointer-events-none text-white border border-gray-700"></div>
            </div>
        </main>

        <!-- 5. SIDEBAR DROITE (Widgets & Presse) -->
        <aside class="w-80 bg-[#13161a] border-l border-gray-800 flex flex-col shrink-0 z-10 overflow-y-auto">
            
            <!-- WIDGETS -->
            <div class="p-4 border-b border-gray-800">
                <h3 class="text-[11px] font-bold text-gray-400 uppercase mb-3 flex items-center gap-2">
                    <i class="ph-fill ph-chart-pie-slice text-blue-500"></i> Sentiment
                </h3>
                
                <!-- Fear & Greed -->
                <div class="bg-[#1a1d24] rounded p-3 border border-gray-800 mb-4">
                    <div class="flex justify-between items-end mb-2">
                        <span class="text-xs text-gray-400">Fear & Greed</span>
                        <span class="text-lg font-bold text-green-400">63</span>
                    </div>
                    <div class="w-full bg-gray-700 h-2 rounded-full overflow-hidden">
                        <div class="bg-gradient-to-r from-red-500 via-yellow-500 to-green-500 h-full w-[63%]"></div>
                    </div>
                    <div class="flex justify-between text-[9px] text-gray-500 mt-1 uppercase">
                        <span>Peur</span>
                        <span class="text-green-400">Avidité</span>
                    </div>
                </div>

                <!-- Top Movers -->
                <h3 class="text-[11px] font-bold text-gray-400 uppercase mb-3 flex items-center gap-2">
                    <i class="ph-fill ph-trend-up text-green-500"></i> Top Movers (24h)
                </h3>
                <div class="space-y-2 text-xs">
                    <div class="flex justify-between p-2 bg-[#1f2329] rounded">
                        <div class="flex items-center gap-2"><div class="w-1 h-3 bg-purple-500 rounded"></div><span class="text-white">SOL</span></div>
                        <span class="text-green-400 font-mono font-bold">+8.4%</span>
                    </div>
                    <div class="flex justify-between p-2 bg-[#1f2329] rounded">
                        <div class="flex items-center gap-2"><div class="w-1 h-3 bg-green-500 rounded"></div><span class="text-white">NVDA</span></div>
                        <span class="text-green-400 font-mono font-bold">+4.1%</span>
                    </div>
                    <div class="flex justify-between p-2 bg-[#1f2329] rounded">
                        <div class="flex items-center gap-2"><div class="w-1 h-3 bg-red-500 rounded"></div><span class="text-white">TSLA</span></div>
                        <span class="text-red-400 font-mono font-bold">-1.2%</span>
                    </div>
                </div>

                <!-- Market Cap -->
                <div class="mt-4 pt-3 border-t border-gray-800 flex justify-between items-center">
                    <span class="text-[10px] text-gray-500 uppercase font-bold">Market Cap Global</span>
                    <span class="text-xs font-mono text-blue-400 font-bold">$2.45T</span>
                </div>
            </div>

            <!-- PRESSE FINANCIÈRE -->
            <div class="flex-1 p-4 bg-[#16191e]">
                <h3 class="text-[11px] font-bold text-gray-400 uppercase mb-4 flex items-center gap-2">
                    <i class="ph-fill ph-newspaper text-blue-500"></i> Presse Financière
                </h3>

                <div class="space-y-4">
                    <!-- Bloomberg -->
                    <div class="group cursor-pointer">
                        <div class="flex justify-between mb-1">
                            <span class="text-[9px] font-bold text-blue-400 uppercase">Bloomberg</span>
                            <span class="text-[9px] text-gray-600">05m</span>
                        </div>
                        <div class="flex gap-3">
                            <h4 class="text-xs text-gray-300 font-medium leading-snug flex-1 group-hover:text-white transition">La SEC approuve un nouvel ETF Bitcoin Spot.</h4>
                            <div class="w-12 h-12 bg-gray-800 rounded overflow-hidden border border-gray-700">
                                <img src="https://placehold.co/48x48/111/FFF?text=B" class="w-full h-full object-cover opacity-70 group-hover:opacity-100">
                            </div>
                        </div>
                    </div>

                    <!-- Reuters -->
                    <div class="group cursor-pointer pt-3 border-t border-gray-800">
                        <div class="flex justify-between mb-1">
                            <span class="text-[9px] font-bold text-orange-500 uppercase">Reuters</span>
                            <span class="text-[9px] text-gray-600">15m</span>
                        </div>
                        <div class="flex gap-3">
                            <h4 class="text-xs text-gray-300 font-medium leading-snug flex-1 group-hover:text-white transition">L'inflation US ralentit plus que prévu.</h4>
                            <div class="w-12 h-12 bg-gray-800 rounded overflow-hidden border border-gray-700">
                                <img src="https://placehold.co/48x48/111/FFF?text=R" class="w-full h-full object-cover opacity-70 group-hover:opacity-100">
                            </div>
                        </div>
                    </div>

                    <!-- FT -->
                    <div class="group cursor-pointer pt-3 border-t border-gray-800">
                        <div class="flex justify-between mb-1">
                            <span class="text-[9px] font-bold text-[#fcd5b5] uppercase">Financial Times</span>
                            <span class="text-[9px] text-gray-600">45m</span>
                        </div>
                        <div class="flex gap-3">
                            <h4 class="text-xs text-gray-300 font-medium leading-snug flex-1 group-hover:text-white transition">La BCE maintient ses taux directeurs.</h4>
                            <div class="w-12 h-12 bg-gray-800 rounded overflow-hidden border border-gray-700">
                                <img src="https://placehold.co/48x48/111/FFF?text=FT" class="w-full h-full object-cover opacity-70 group-hover:opacity-100">
                            </div>
                        </div>
                    </div>

                    <!-- Les Échos -->
                    <div class="group cursor-pointer pt-3 border-t border-gray-800">
                        <div class="flex justify-between mb-1">
                            <span class="text-[9px] font-bold text-red-500 uppercase">Les Échos</span>
                            <span class="text-[9px] text-gray-600">1h</span>
                        </div>
                        <div class="flex gap-3">
                            <h4 class="text-xs text-gray-300 font-medium leading-snug flex-1 group-hover:text-white transition">CAC 40: Ouverture en hausse avec le Luxe.</h4>
                            <div class="w-12 h-12 bg-gray-800 rounded overflow-hidden border border-gray-700">
                                <img src="https://placehold.co/48x48/111/FFF?text=E" class="w-full h-full object-cover opacity-70 group-hover:opacity-100">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

    </div>

    <script>
        // --- 1. Horloge Mondiale ---
        function updateClocks() {
            const now = new Date();
            const fmt = (tz) => new Intl.DateTimeFormat('en-US', {hour:'2-digit', minute:'2-digit', hour12:false, timeZone:tz}).format(now);
            document.getElementById('time-ny').innerText = fmt('America/New_York');
            document.getElementById('time-london').innerText = fmt('Europe/London');
            document.getElementById('time-tokyo').innerText = fmt('Asia/Tokyo');
        }
        setInterval(updateClocks, 60000);
        updateClocks();

        // --- 2. Graphique ---
        const container = document.getElementById('chart-container');
        const legend = document.getElementById('legend');
        const chart = LightweightCharts.createChart(container, {
            layout: { background: { type: 'solid', color: '#0f1115' }, textColor: '#6b7280', fontFamily: 'Inter' },
            grid: { vertLines: { color: '#1f2937' }, horzLines: { color: '#1f2937' } },
            crosshair: { mode: LightweightCharts.CrosshairMode.Normal },
            timeScale: { borderColor: '#1f2937', timeVisible: true, secondsVisible: false },
            rightPriceScale: { borderColor: '#1f2937', scaleMargins: { top: 0.1, bottom: 0.2 } },
        });

        const candleSeries = chart.addCandlestickSeries({
            upColor: '#22c55e', downColor: '#ef4444', borderVisible: false, wickUpColor: '#22c55e', wickDownColor: '#ef4444'
        });
        const volumeSeries = chart.addHistogramSeries({
            color: '#26a69a', priceFormat: { type: 'volume' }, priceScaleId: '',
        });
        volumeSeries.priceScale().applyOptions({ scaleMargins: { top: 0.85, bottom: 0 } });

        // Resize
        new ResizeObserver(entries => {
            const rect = entries[0].contentRect;
            chart.applyOptions({ width: rect.width, height: rect.height });
        }).observe(container);

        // --- 3. Données & Timeframes (CORRECTIF MAJEUR) ---
        function generateData(timeframe) {
            const data = [], vol = [];
            let time = Math.floor(Date.now() / 1000) - (1000 * 3600 * 24); // Start past
            let close = 25000;
            let step = 3600; // Default 1H
            let count = 500; // Default bars

            // Logique Timeframe simplifiée pour la démo
            switch(timeframe) {
                case '1D': step = 3600; count = 100; break; // 1 Day view ~ hourly
                case '1W': step = 3600 * 4; count = 150; break; // 4H bars
                case '1M': step = 3600 * 12; count = 200; break; // 12H bars
                case '3M': step = 3600 * 24; count = 90; break; // Daily bars
                case '1Y': step = 3600 * 24; count = 365; break; 
                case '5Y': step = 3600 * 24 * 7; count = 260; break; // Weekly
                case 'MAX': step = 3600 * 24 * 30; count = 100; break; // Monthly
                default: step = 3600;
            }

            // Ajuster le temps de départ pour que la dernière bougie soit "maintenant"
            time = Math.floor(Date.now() / 1000) - (count * step);

            for (let i = 0; i < count; i++) {
                let open = close;
                let change = (Math.random() - 0.5) * (close * 0.02); // 2% volatility
                close = open + change;
                let high = Math.max(open, close) + Math.random() * (close * 0.005);
                let low = Math.min(open, close) - Math.random() * (close * 0.005);

                // Validation simple
                if(high < low) high = low + 1;

                data.push({ time, open, high, low, close });
                vol.push({
                    time, 
                    value: Math.random() * 10000, 
                    color: close > open ? 'rgba(34, 197, 94, 0.4)' : 'rgba(239, 68, 68, 0.4)'
                });
                time += step;
            }
            return { data, vol };
        }

        // Fonction appelée par les boutons
        window.updateTimeframe = function(tf, btnElement) {
            // Update UI
            document.querySelectorAll('#timeframe-container button').forEach(b => b.classList.remove('btn-timeframe-active', 'text-white', 'font-bold'));
            document.querySelectorAll('#timeframe-container button').forEach(b => b.classList.add('text-gray-400'));
            
            btnElement.classList.remove('text-gray-400');
            btnElement.classList.add('btn-timeframe-active');

            // Update Data
            const { data, vol } = generateData(tf);
            candleSeries.setData(data);
            volumeSeries.setData(vol);
            chart.timeScale().fitContent();
        };

        // Initialisation (1D par défaut)
        const initialData = generateData('1D');
        candleSeries.setData(initialData.data);
        volumeSeries.setData(initialData.vol);

        // --- 4. Tooltip ---
        chart.subscribeCrosshairMove(param => {
            if (!param || !param.time || !candleSeries) {
                legend.style.display = 'none';
                ['open', 'high', 'low', 'close'].forEach(id => document.getElementById(`ohlc-${id}`).innerText = '-');
                return;
            }
            const d = param.seriesData.get(candleSeries);
            if (d) {
                document.getElementById('ohlc-open').innerText = d.open.toFixed(2);
                document.getElementById('ohlc-high').innerText = d.high.toFixed(2);
                document.getElementById('ohlc-low').innerText = d.low.toFixed(2);
                document.getElementById('ohlc-close').innerText = d.close.toFixed(2);
                
                const color = d.close >= d.open ? 'text-green-400' : 'text-red-400';
                legend.style.display = 'block';
                legend.innerHTML = `<div>BTC/USD <span class="${color}">${d.close.toFixed(2)}</span></div>`;
            }
        });

    </script>
</body>
</html>
