<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NovaTrade Pro v10.2 - Plateforme de Trading Avancée</title>
    <!-- Tailwind CSS pour le style rapide et moderne -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lightweight Charts v4.1.1 FIXÉE (Version stable pour chandeliers) -->
    <script src="https://unpkg.com/lightweight-charts@4.1.1/dist/lightweight-charts.standalone.production.js"></script>
    <!-- Google Fonts : Inter pour l'UI, JetBrains Mono pour les chiffres -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <!-- Phosphor Icons pour les icônes vectorielles -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        /* Configuration globale sombre */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f1115; /* Fond "Deep Space" pour réduire la fatigue oculaire */
            color: #cfd3da; /* Texte gris clair lisible */
        }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        
        /* Scrollbar personnalisée fine et sombre */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #13161a; }
        ::-webkit-scrollbar-thumb { background: #2d333b; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #404854; }

        /* Effet de verre (Glassmorphism) pour le header */
        .glass-header {
            background: rgba(19, 22, 26, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #2d333b;
        }

        /* Animation "Live" (Point vert pulsant) */
        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4); }
            70% { box-shadow: 0 0 0 6px rgba(34, 197, 94, 0); }
            100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
        }
        .live-indicator {
            animation: pulse-green 2s infinite;
        }

        /* Utilitaires pour les bordures */
        .border-theme { border-color: #1f2937; }
        .bg-panel { background-color: #13161a; }
    </style>
</head>
<body class="flex flex-col h-screen overflow-hidden text-sm selection:bg-blue-500 selection:text-white">

    <!-- 1. BARRE DES MARCHÉS MONDIALE (World Markets Ticker) -->
    <div class="bg-black text-gray-500 text-[10px] py-1 px-4 flex justify-center space-x-8 border-b border-gray-800 font-mono tracking-wider uppercase z-30">
        <span class="flex items-center gap-2"><i class="ph-fill ph-clock"></i> NY (NYSE): <span class="text-green-500 font-bold" id="time-ny">--:--</span></span>
        <span class="flex items-center gap-2"><i class="ph-fill ph-clock"></i> LONDON (LSE): <span class="text-yellow-500 font-bold" id="time-london">--:--</span></span>
        <span class="flex items-center gap-2"><i class="ph-fill ph-clock"></i> TOKYO (TSE): <span class="text-gray-400 font-bold" id="time-tokyo">--:--</span></span>
        <span class="flex items-center gap-2"><i class="ph-fill ph-globe"></i> SYDNEY (ASX): <span class="text-gray-400 font-bold" id="time-sydney">--:--</span></span>
    </div>

    <!-- 2. HEADER PRINCIPAL -->
    <header class="glass-header h-14 flex items-center justify-between px-4 shrink-0 z-20">
        <!-- Logo & Version -->
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-gradient-to-br from-blue-600 to-blue-800 rounded-lg flex items-center justify-center shadow-lg shadow-blue-900/20 border border-blue-500/30">
                <i class="ph-bold ph-chart-polar text-white text-xl"></i>
            </div>
            <div class="flex flex-col">
                <h1 class="font-bold text-white leading-none tracking-tight text-base">NovaTrade <span class="text-blue-500">Pro</span></h1>
                <span class="text-[10px] text-gray-500 font-mono mt-0.5">v10.2 Extended Timeframes</span>
            </div>
        </div>

        <!-- Navigation Header -->
        <nav class="hidden md:flex items-center gap-6 text-xs font-medium text-gray-400">
            <a href="#" class="text-white hover:text-blue-400 transition-colors">Marchés</a>
            <a href="#" class="hover:text-blue-400 transition-colors">Trading Spot</a>
            <a href="#" class="hover:text-blue-400 transition-colors">Futures</a>
            <a href="#" class="hover:text-blue-400 transition-colors">Analyse</a>
        </nav>

        <!-- Actions Utilisateur -->
        <div class="flex items-center gap-4">
            <div class="flex items-center gap-2 bg-[#1a1d24] px-3 py-1.5 rounded border border-gray-800 text-xs">
                <div class="w-2 h-2 bg-green-500 rounded-full live-indicator"></div>
                <span class="text-green-400 font-mono">Connecté</span>
            </div>
            <button class="flex items-center gap-2 bg-blue-600 hover:bg-blue-500 text-white px-4 py-1.5 rounded text-xs font-bold transition-all shadow-lg shadow-blue-900/20">
                <i class="ph-bold ph-sign-in"></i> Espace Client
            </button>
            <button class="text-gray-400 hover:text-white p-1 rounded hover:bg-gray-800 transition-colors">
                <i class="ph-bold ph-gear text-lg"></i>
            </button>
        </div>
    </header>

    <!-- LAYOUT PRINCIPAL (Grid flexible) -->
    <div class="flex flex-1 overflow-hidden">

        <!-- 3. SIDEBAR GAUCHE (Navigation & Actifs) -->
        <aside class="w-72 bg-panel border-r border-theme flex flex-col shrink-0 z-10">
            <!-- Onglets de catégories d'actifs -->
            <div class="flex border-b border-theme text-xs font-medium">
                <button class="flex-1 py-3 text-blue-400 border-b-2 border-blue-500 bg-[#1a1d24] transition-colors">Crypto</button>
                <button class="flex-1 py-3 text-gray-500 hover:text-gray-300 hover:bg-[#1a1d24] transition-colors">Actions</button>
                <button class="flex-1 py-3 text-gray-500 hover:text-gray-300 hover:bg-[#1a1d24] transition-colors">Matières</button>
            </div>

            <!-- Liste des actifs défilante -->
            <div class="overflow-y-auto flex-1 p-2 space-y-1">
                <!-- Section Crypto -->
                <div class="flex items-center justify-between px-2 mt-2 mb-1 text-[10px] font-bold text-gray-600 uppercase tracking-wider">
                    <span>Crypto-monnaies</span>
                    <i class="ph-bold ph-caret-down"></i>
                </div>
                
                <!-- BTC Item (Actif sélectionné) -->
                <div class="group cursor-pointer p-2 rounded bg-[#2d333b]/40 border border-blue-500/30 flex justify-between items-center hover:bg-[#2d333b] transition-all">
                    <div class="flex items-center gap-3">
                        <i class="ph-fill ph-currency-btc text-orange-500 text-lg"></i>
                        <div>
                            <div class="text-white font-bold text-xs group-hover:text-blue-400">BTC/USD</div>
                            <div class="text-[10px] text-gray-500">Bitcoin Spot</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-white font-mono text-xs font-medium" id="sidebar-btc-price">25,432.10</div>
                        <div class="text-green-500 text-[10px] font-medium bg-green-500/10 px-1 rounded">+2.45%</div>
                    </div>
                </div>

                <!-- ETH Item -->
                <div class="group cursor-pointer p-2 rounded hover:bg-[#1e2229] border border-transparent flex justify-between items-center transition-all">
                    <div class="flex items-center gap-3">
                        <i class="ph-fill ph-currency-eth text-indigo-400 text-lg"></i>
                        <div>
                            <div class="text-gray-300 group-hover:text-white font-medium text-xs">ETH/USD</div>
                            <div class="text-[10px] text-gray-600">Ethereum</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-gray-400 font-mono text-xs">1,654.20</div>
                        <div class="text-green-500 text-[10px]">+1.20%</div>
                    </div>
                </div>

                <!-- SOL Item -->
                <div class="group cursor-pointer p-2 rounded hover:bg-[#1e2229] border border-transparent flex justify-between items-center transition-all">
                    <div class="flex items-center gap-3">
                        <div class="w-4 h-4 rounded-full bg-purple-600 flex items-center justify-center text-[9px] text-white font-bold shadow-sm">S</div>
                        <div>
                            <div class="text-gray-300 group-hover:text-white font-medium text-xs">SOL/USD</div>
                            <div class="text-[10px] text-gray-600">Solana</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-gray-400 font-mono text-xs">23.45</div>
                        <div class="text-red-500 text-[10px]">-0.45%</div>
                    </div>
                </div>

                <!-- BNB Item -->
                <div class="group cursor-pointer p-2 rounded hover:bg-[#1e2229] border border-transparent flex justify-between items-center transition-all">
                    <div class="flex items-center gap-3">
                        <div class="w-4 h-4 rounded-full bg-yellow-500 flex items-center justify-center text-[9px] text-black font-bold shadow-sm">B</div>
                        <div>
                            <div class="text-gray-300 group-hover:text-white font-medium text-xs">BNB/USD</div>
                            <div class="text-[10px] text-gray-600">Binance Coin</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-gray-400 font-mono text-xs">215.10</div>
                        <div class="text-green-500 text-[10px]">+0.15%</div>
                    </div>
                </div>

                <!-- XRP Item -->
                <div class="group cursor-pointer p-2 rounded hover:bg-[#1e2229] border border-transparent flex justify-between items-center transition-all">
                    <div class="flex items-center gap-3">
                        <div class="w-4 h-4 rounded-full bg-gray-200 flex items-center justify-center text-[9px] text-black font-bold shadow-sm">X</div>
                        <div>
                            <div class="text-gray-300 group-hover:text-white font-medium text-xs">XRP/USD</div>
                            <div class="text-[10px] text-gray-600">Ripple</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-gray-400 font-mono text-xs">0.5234</div>
                        <div class="text-green-500 text-[10px]">+1.12%</div>
                    </div>
                </div>

                <div class="h-px bg-gray-800 my-2 mx-2"></div>

                <!-- Section Actions -->
                <div class="flex items-center justify-between px-2 mt-2 mb-1 text-[10px] font-bold text-gray-600 uppercase tracking-wider">
                    <span>Actions Tech (NASDAQ)</span>
                    <i class="ph-bold ph-caret-down"></i>
                </div>
                
                <div class="asset-item p-2 rounded cursor-pointer hover:bg-[#1e2229] flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <i class="ph-fill ph-apple-logo text-gray-400 text-lg"></i>
                        <div class="text-xs text-gray-400">AAPL</div>
                    </div>
                    <div class="text-xs font-mono text-gray-400">178.35 <span class="text-green-500 text-[10px] ml-1">+0.5%</span></div>
                </div>
                <div class="asset-item p-2 rounded cursor-pointer hover:bg-[#1e2229] flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <i class="ph-fill ph-microsoft-logo text-blue-400 text-lg"></i>
                        <div class="text-xs text-gray-400">MSFT</div>
                    </div>
                    <div class="text-xs font-mono text-gray-400">330.12 <span class="text-red-500 text-[10px] ml-1">-0.2%</span></div>
                </div>
                <div class="asset-item p-2 rounded cursor-pointer hover:bg-[#1e2229] flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <i class="ph-fill ph-google-logo text-red-400 text-lg"></i>
                        <div class="text-xs text-gray-400">GOOGL</div>
                    </div>
                    <div class="text-xs font-mono text-gray-400">135.60 <span class="text-green-500 text-[10px] ml-1">+1.1%</span></div>
                </div>
                <div class="asset-item p-2 rounded cursor-pointer hover:bg-[#1e2229] flex justify-between items-center">
                    <div class="flex items-center gap-3">
                        <i class="ph-fill ph-car text-red-500 text-lg"></i>
                        <div class="text-xs text-gray-400">TSLA</div>
                    </div>
                    <div class="text-xs font-mono text-gray-400">245.50 <span class="text-green-500 text-[10px] ml-1">+3.2%</span></div>
                </div>

                <div class="h-px bg-gray-800 my-2 mx-2"></div>

                <!-- Section Matières -->
                <div class="flex items-center justify-between px-2 mt-2 mb-1 text-[10px] font-bold text-gray-600 uppercase tracking-wider">
                    <span>Commodities</span>
                    <i class="ph-bold ph-caret-down"></i>
                </div>
                
                <div class="asset-item p-2 rounded cursor-pointer hover:bg-[#1e2229] flex justify-between items-center">
                    <div class="text-xs text-yellow-600 flex items-center gap-2"><i class="ph-fill ph-coins text-lg"></i> Or (XAU)</div>
                    <div class="text-xs font-mono text-gray-400">1,945.20</div>
                </div>
                <div class="asset-item p-2 rounded cursor-pointer hover:bg-[#1e2229] flex justify-between items-center">
                    <div class="text-xs text-gray-400 flex items-center gap-2"><i class="ph-fill ph-coins text-lg"></i> Argent (XAG)</div>
                    <div class="text-xs font-mono text-gray-400">23.10</div>
                </div>
                <div class="asset-item p-2 rounded cursor-pointer hover:bg-[#1e2229] flex justify-between items-center">
                    <div class="text-xs text-blue-300 flex items-center gap-2"><i class="ph-fill ph-drop text-lg"></i> Pétrole</div>
                    <div class="text-xs font-mono text-gray-400">85.40</div>
                </div>
            </div>
        </aside>

        <!-- 4. CONTENU CENTRAL (Graphique) -->
        <main class="flex-1 flex flex-col relative bg-[#0f1115]">
            <!-- Barre d'outils du graphique -->
            <div class="h-12 border-b border-theme flex items-center justify-between px-4 bg-panel">
                <!-- Info Actif & Timeframe -->
                <div class="flex items-center gap-4">
                    <div class="flex items-center gap-2">
                        <i class="ph-fill ph-currency-btc text-orange-500 text-xl"></i>
                        <span class="text-white font-bold text-sm">BTC/USD</span>
                    </div>
                    
                    <div class="flex bg-[#1a1d24] rounded p-0.5 border border-gray-800">
                        <button class="px-2 py-0.5 text-[10px] text-gray-400 hover:bg-gray-700 rounded transition">15m</button>
                        <button class="px-2 py-0.5 text-[10px] text-white bg-gray-700 rounded font-bold shadow-sm">1H</button>
                        <button class="px-2 py-0.5 text-[10px] text-gray-400 hover:bg-gray-700 rounded transition">4H</button>
                        <button class="px-2 py-0.5 text-[10px] text-gray-400 hover:bg-gray-700 rounded transition">1D</button>
                    </div>

                    <div class="h-4 w-px bg-gray-700 mx-1"></div>
                    
                    <div class="flex items-center gap-2 text-xs text-gray-400">
                        <button class="hover:text-white"><i class="ph-bold ph-chart-bar"></i></button>
                        <button class="hover:text-white"><i class="ph-bold ph-function"></i></button>
                        <button class="hover:text-white"><i class="ph-bold ph-gear"></i></button>
                    </div>

                    <div class="ml-4 flex items-center gap-2 px-2 py-1 bg-green-900/20 rounded border border-green-900/50">
                        <span class="w-1.5 h-1.5 rounded-full bg-green-500 live-indicator"></span>
                        <span class="text-[10px] text-green-400 font-mono uppercase tracking-wide">Marché Ouvert</span>
                    </div>
                </div>

                <!-- Affichage OHLC Dynamique -->
                <div class="hidden xl:flex items-center gap-6 font-mono text-[10px] text-gray-500">
                    <span class="flex gap-1">O: <span id="ohlc-open" class="text-blue-400 font-medium">-</span></span>
                    <span class="flex gap-1">H: <span id="ohlc-high" class="text-green-400 font-medium">-</span></span>
                    <span class="flex gap-1">L: <span id="ohlc-low" class="text-red-400 font-medium">-</span></span>
                    <span class="flex gap-1">C: <span id="ohlc-close" class="text-white font-medium">-</span></span>
                </div>
            </div>

            <!-- CONTENEUR DU GRAPHIQUE -->
            <div class="relative w-full h-full group">
                <div id="chart-container" class="w-full h-full"></div>
                <!-- Légende flottante interne -->
                <div id="legend" class="absolute top-3 left-3 z-10 pointer-events-none bg-[#13161a]/90 backdrop-blur px-3 py-2 rounded border border-gray-700 text-xs font-mono hidden shadow-xl">
                    <!-- Contenu injecté par JS -->
                </div>
            </div>
        </main>

        <!-- 5. SIDEBAR DROITE (Widgets & Presse) -->
        <aside class="w-80 bg-panel border-l border-theme flex flex-col shrink-0 overflow-y-auto z-10 custom-scrollbar">
            
            <!-- WIDGETS -->
            <div class="p-4 border-b border-theme">
                <h3 class="text-[11px] font-bold text-gray-400 uppercase mb-4 flex items-center gap-2 tracking-wider">
                    <i class="ph-fill ph-chart-pie-slice text-blue-500"></i> Sentiment & Tendances
                </h3>
                
                <!-- Fear & Greed Index -->
                <div class="bg-[#1a1d24] rounded-lg p-3 mb-4 border border-gray-800 relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-1 opacity-10">
                        <i class="ph-fill ph-gauge text-6xl text-white"></i>
                    </div>
                    <div class="flex justify-between items-end mb-2 relative z-10">
                        <span class="text-xs text-gray-400 font-medium">Fear & Greed</span>
                        <span class="text-xl font-bold text-green-400">63</span>
                    </div>
                    <div class="w-full bg-gray-700 h-1.5 rounded-full overflow-hidden mb-1">
                        <div class="bg-gradient-to-r from-red-500 via-yellow-500 to-green-500 h-full w-[63%] rounded-full"></div>
                    </div>
                    <div class="flex justify-between text-[9px] text-gray-500 font-mono uppercase">
                        <span>Extrême Peur</span>
                        <span class="text-green-400 font-bold">Avidité</span>
                    </div>
                </div>

                <!-- Top Movers Widget -->
                <div class="space-y-3">
                    <div class="text-[10px] text-gray-500 uppercase font-bold tracking-wider mb-2">Top Performers (24h)</div>
                    <div class="flex justify-between items-center text-xs p-2 bg-[#1f2329] rounded border border-transparent hover:border-gray-700 transition">
                        <div class="flex items-center gap-2">
                            <div class="w-1 h-4 bg-purple-500 rounded-full"></div>
                            <span class="text-white font-medium">SOL</span>
                        </div>
                        <span class="text-green-400 font-mono font-bold">+8.4%</span>
                    </div>
                    <div class="flex justify-between items-center text-xs p-2 bg-[#1f2329] rounded border border-transparent hover:border-gray-700 transition">
                        <div class="flex items-center gap-2">
                            <div class="w-1 h-4 bg-red-500 rounded-full"></div>
                            <span class="text-white font-medium">TSLA</span>
                        </div>
                        <span class="text-green-400 font-mono font-bold">+3.2%</span>
                    </div>
                    <div class="flex justify-between items-center text-xs p-2 bg-[#1f2329] rounded border border-transparent hover:border-gray-700 transition">
                        <div class="flex items-center gap-2">
                            <div class="w-1 h-4 bg-green-500 rounded-full"></div>
                            <span class="text-white font-medium">NVDA</span>
                        </div>
                        <span class="text-red-400 font-mono font-bold">-1.5%</span>
                    </div>
                </div>

                <!-- Market Cap Widget -->
                <div class="mt-4 pt-4 border-t border-gray-800 flex justify-between items-center">
                    <div class="text-[10px] text-gray-500 uppercase font-bold">Market Cap Global</div>
                    <div class="text-xs font-mono text-blue-400 font-bold">$2.45T <span class="text-green-500 text-[10px] ml-1">(+1.2%)</span></div>
                </div>
            </div>

            <!-- SECTION PRESSE FINANCIÈRE -->
            <div class="flex-1 p-4 bg-[#16191e]">
                <h3 class="text-[11px] font-bold text-gray-400 uppercase mb-4 flex items-center gap-2 tracking-wider">
                    <i class="ph-fill ph-newspaper text-blue-500"></i> Presse Financière
                </h3>

                <div class="space-y-5">
                    <!-- Bloomberg Article -->
                    <div class="group cursor-pointer">
                        <div class="flex items-center justify-between mb-1.5">
                            <div class="flex items-center gap-1.5">
                                <div class="w-1 h-1 rounded-full bg-blue-500"></div>
                                <span class="text-[10px] font-bold text-white tracking-wide">BLOOMBERG</span>
                            </div>
                            <span class="text-[10px] text-gray-600 font-mono">05m</span>
                        </div>
                        <div class="flex gap-3">
                            <div class="flex-1">
                                <h4 class="text-xs text-gray-300 font-medium leading-snug group-hover:text-blue-400 transition-colors line-clamp-3">La SEC approuve un nouvel ETF Bitcoin Spot en urgence face à la pression institutionnelle.</h4>
                            </div>
                            <div class="w-14 h-14 bg-gray-800 rounded-md overflow-hidden shrink-0 border border-gray-700">
                                <img src="https://placehold.co/56x56/1a1d24/FFF?text=B" alt="news" class="w-full h-full object-cover opacity-70 group-hover:opacity-100 group-hover:scale-110 transition-all duration-300">
                            </div>
                        </div>
                    </div>

                    <!-- Reuters Article -->
                    <div class="group cursor-pointer pt-4 border-t border-gray-800/50">
                        <div class="flex items-center justify-between mb-1.5">
                            <div class="flex items-center gap-1.5">
                                <div class="w-1 h-1 rounded-full bg-orange-500"></div>
                                <span class="text-[10px] font-bold text-white tracking-wide">REUTERS</span>
                            </div>
                            <span class="text-[10px] text-gray-600 font-mono">12m</span>
                        </div>
                        <div class="flex gap-3">
                            <div class="flex-1">
                                <h4 class="text-xs text-gray-300 font-medium leading-snug group-hover:text-orange-400 transition-colors line-clamp-3">L'inflation US ralentit plus que prévu selon les derniers chiffres du département du commerce.</h4>
                            </div>
                            <div class="w-14 h-14 bg-gray-800 rounded-md overflow-hidden shrink-0 border border-gray-700">
                                <img src="https://placehold.co/56x56/1a1d24/FFF?text=R" alt="news" class="w-full h-full object-cover opacity-70 group-hover:opacity-100 group-hover:scale-110 transition-all duration-300">
                            </div>
                        </div>
                    </div>

                    <!-- FT Article -->
                    <div class="group cursor-pointer pt-4 border-t border-gray-800/50">
                        <div class="flex items-center justify-between mb-1.5">
                            <div class="flex items-center gap-1.5">
                                <div class="w-1 h-1 rounded-full bg-[#fcd5b5]"></div>
                                <span class="text-[10px] font-bold text-[#fcd5b5] tracking-wide">FINANCIAL TIMES</span>
                            </div>
                            <span class="text-[10px] text-gray-600 font-mono">45m</span>
                        </div>
                        <div class="flex gap-3">
                            <div class="flex-1">
                                <h4 class="text-xs text-gray-300 font-medium leading-snug group-hover:text-[#fcd5b5] transition-colors line-clamp-3">La BCE maintient ses taux directeurs inchangés pour le troisième trimestre consécutif.</h4>
                            </div>
                            <div class="w-14 h-14 bg-gray-800 rounded-md overflow-hidden shrink-0 border border-gray-700">
                                <img src="https://placehold.co/56x56/1a1d24/FFF?text=FT" alt="news" class="w-full h-full object-cover opacity-70 group-hover:opacity-100 group-hover:scale-110 transition-all duration-300">
                            </div>
                        </div>
                    </div>

                    <!-- Les Échos Article -->
                    <div class="group cursor-pointer pt-4 border-t border-gray-800/50">
                        <div class="flex items-center justify-between mb-1.5">
                            <div class="flex items-center gap-1.5">
                                <div class="w-1 h-1 rounded-full bg-red-600"></div>
                                <span class="text-[10px] font-bold text-white tracking-wide">LES ÉCHOS</span>
                            </div>
                            <span class="text-[10px] text-gray-600 font-mono">1h</span>
                        </div>
                        <div class="flex gap-3">
                            <div class="flex-1">
                                <h4 class="text-xs text-gray-300 font-medium leading-snug group-hover:text-red-400 transition-colors line-clamp-3">CAC 40 : Ouverture en forte hausse portée par le secteur du luxe et LVMH.</h4>
                            </div>
                            <div class="w-14 h-14 bg-gray-800 rounded-md overflow-hidden shrink-0 border border-gray-700">
                                <img src="https://placehold.co/56x56/1a1d24/FFF?text=E" alt="news" class="w-full h-full object-cover opacity-70 group-hover:opacity-100 group-hover:scale-110 transition-all duration-300">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

    </div>

    <!-- LOGIQUE JAVASCRIPT (Optimisée & Robuste) -->
    <script>
        // --- 1. Horloge Mondiale ---
        function updateWorldClocks() {
            const now = new Date();
            const format = (timeZone) => new Intl.DateTimeFormat('en-US', { hour: '2-digit', minute: '2-digit', hour12: false, timeZone }).format(now);
            
            const zones = [
                { id: 'time-ny', zone: 'America/New_York' },
                { id: 'time-london', zone: 'Europe/London' },
                { id: 'time-tokyo', zone: 'Asia/Tokyo' },
                { id: 'time-sydney', zone: 'Australia/Sydney' }
            ];

            zones.forEach(item => {
                const el = document.getElementById(item.id);
                if(el) el.innerText = format(item.zone);
            });
        }
        setInterval(updateWorldClocks, 60000); // Update every minute
        updateWorldClocks(); // Initial call

        // --- 2. Configuration du Graphique ---
        const container = document.getElementById('chart-container');
        const legend = document.getElementById('legend');

        // Vérification de sécurité si la librairie ne charge pas
        if (typeof LightweightCharts === 'undefined') {
            container.innerHTML = `
                <div class="flex items-center justify-center h-full flex-col gap-4 text-red-500">
                    <i class="ph-bold ph-warning-circle text-4xl"></i>
                    <span>Erreur critique: Librairie graphique manquante.</span>
                </div>`;
            throw new Error('Lightweight Charts not loaded');
        }
        
        const chartProperties = {
            width: container.clientWidth,
            height: container.clientHeight,
            layout: {
                background: { type: 'solid', color: '#0f1115' }, // Match le fond du body
                textColor: '#6b7280',
                fontFamily: 'Inter',
                fontSize: 11,
            },
            grid: {
                vertLines: { color: '#1f2937', style: 1 }, // Lignes subtiles
                horzLines: { color: '#1f2937', style: 1 },
            },
            crosshair: {
                mode: LightweightCharts.CrosshairMode.Normal,
                vertLine: { color: '#4b5563', width: 1, style: 3, labelBackgroundColor: '#1f2937' },
                horzLine: { color: '#4b5563', width: 1, style: 3, labelBackgroundColor: '#1f2937' },
            },
            timeScale: {
                borderColor: '#1f2937',
                timeVisible: true,
                secondsVisible: false,
                fixLeftEdge: true,
                rightOffset: 10,
            },
            rightPriceScale: {
                borderColor: '#1f2937',
                scaleMargins: {
                    top: 0.1,
                    bottom: 0.2, // Espace pour le volume
                },
            },
        };

        const chart = LightweightCharts.createChart(container, chartProperties);

        // --- 3. Séries de Données ---
        let candleSeries;
        let volumeSeries;

        // Initialisation de la série Candlestick avec gestion d'erreur
        try {
            candleSeries = chart.addCandlestickSeries({
                upColor: '#22c55e', // Green-500 (Tailwind)
                downColor: '#ef4444', // Red-500 (Tailwind)
                borderVisible: false,
                wickUpColor: '#22c55e',
                wickDownColor: '#ef4444',
            });
        } catch (e) {
            console.warn("Candlestick series failed, falling back to line.", e);
            // Fallback visuel simple
            candleSeries = chart.addLineSeries({ color: '#3b82f6' });
        }

        // Initialisation de la série Volume
        try {
            volumeSeries = chart.addHistogramSeries({
                color: '#26a69a',
                priceFormat: { type: 'volume' },
                priceScaleId: '', // Overlay
            });
            volumeSeries.priceScale().applyOptions({
                scaleMargins: {
                    top: 0.85, // Le volume prend 15% en bas
                    bottom: 0,
                },
            });
        } catch (e) {
            console.warn("Volume series failed initialization", e);
        }

        // --- 4. Génération & Validation des Données (Le Fix Critique) ---
        
        // Fonction de validation stricte pour éviter les erreurs JS 'toFixed'
        function validateCandle(candle) {
            if (!candle) return false;
            // Vérification des types et des NaN
            if (typeof candle.time === 'undefined' || candle.time === null) return false;
            if (typeof candle.open !== 'number' || isNaN(candle.open)) return false;
            if (typeof candle.high !== 'number' || isNaN(candle.high)) return false;
            if (typeof candle.low !== 'number' || isNaN(candle.low)) return false;
            if (typeof candle.close !== 'number' || isNaN(candle.close)) return false;
            
            // Logique métier : High doit être le plus haut, Low le plus bas
            if (candle.high < candle.low || candle.high < candle.open || candle.high < candle.close) {
                // Correction automatique silencieuse si possible, ou rejet
                // Ici on rejette pour être sûr
                return false;
            }
            if (candle.low > candle.open || candle.low > candle.close) {
                return false;
            }
            return true;
        }

        function generateData() {
            const initialData = [];
            const volumeData = [];
            // Date de départ fixe pour cohérence
            let time = Math.floor(new Date('2023-01-01').getTime() / 1000);
            let close = 25432.10; // Prix de départ BTC

            for (let i = 0; i < 1000; i++) {
                const volatility = 80;
                const change = (Math.random() - 0.5) * volatility * 4;
                const open = close;
                close = open + change;
                
                // Génération réaliste High/Low
                let high = Math.max(open, close) + Math.random() * (volatility * 0.5);
                let low = Math.min(open, close) - Math.random() * (volatility * 0.5);

                // Arrondir pour éviter les problèmes de virgule flottante bizarres
                const candle = {
                    time: time,
                    open: parseFloat(open.toFixed(2)),
                    high: parseFloat(high.toFixed(2)),
                    low: parseFloat(low.toFixed(2)),
                    close: parseFloat(close.toFixed(2)),
                };

                const volume = {
                    time: time,
                    value: Math.random() * 1500 + 200,
                    color: close > open ? 'rgba(34, 197, 94, 0.4)' : 'rgba(239, 68, 68, 0.4)',
                };

                if (validateCandle(candle)) {
                    initialData.push(candle);
                    volumeData.push(volume);
                }
                time += 3600; // +1 heure
            }
            return { initialData, volumeData };
        }

        // Injection des données initiales
        const { initialData, volumeData } = generateData();
        if (candleSeries) candleSeries.setData(initialData);
        if (volumeSeries) volumeSeries.setData(volumeData);

        // --- 5. Interactivité (Tooltip & Légende) ---
        chart.subscribeCrosshairMove((param) => {
            const ohlcIds = ['open', 'high', 'low', 'close'];
            
            // Si la souris sort du graphique
            if (!param || !param.time || !candleSeries || param.point.x < 0 || param.point.x > container.clientWidth || param.point.y < 0 || param.point.y > container.clientHeight) {
                ohlcIds.forEach(id => {
                    const el = document.getElementById(`ohlc-${id}`);
                    if(el) el.innerText = '-';
                });
                if(legend) legend.style.display = 'none';
                return;
            }

            const data = param.seriesData.get(candleSeries);
            if (data) {
                // Mise à jour de la barre header
                document.getElementById('ohlc-open').innerText = data.open.toFixed(2);
                document.getElementById('ohlc-high').innerText = data.high.toFixed(2);
                document.getElementById('ohlc-low').innerText = data.low.toFixed(2);
                document.getElementById('ohlc-close').innerText = data.close.toFixed(2);
                
                // Mise à jour de la légende flottante
                if(legend) {
                    const change = data.close - data.open;
                    const percent = (change / data.open) * 100;
                    const colorClass = change >= 0 ? 'text-green-400' : 'text-red-400';
                    const icon = change >= 0 ? '↑' : '↓';
                    
                    legend.style.display = 'block';
                    legend.innerHTML = `
                        <div class="flex flex-col gap-1">
                            <span class="text-gray-400 text-[10px]">BTC/USD • 1H</span>
                            <div class="font-bold text-sm text-white">${data.close.toFixed(2)}</div>
                            <div class="${colorClass} text-[10px] flex items-center gap-1">
                                <span>${icon} ${Math.abs(change).toFixed(2)} (${percent.toFixed(2)}%)</span>
                            </div>
                        </div>
                    `;
                }
            }
        });

        // --- 6. Redimensionnement Réactif (ResizeObserver) ---
        const resizeObserver = new ResizeObserver(entries => {
            if (entries.length === 0 || !entries[0].contentRect) return;
            const newRect = entries[0].contentRect;
            chart.applyOptions({ width: newRect.width, height: newRect.height });
        });
        resizeObserver.observe(container);

        // --- 7. Simulation Temps Réel (Live Feed) ---
        if (initialData.length > 0) {
            let lastClose = initialData[initialData.length - 1].close;
            let lastTime = initialData[initialData.length - 1].time;
            const btcPriceEl = document.getElementById('sidebar-btc-price');
            
            setInterval(() => {
                // Prochaine bougie (simulation 1h accélérée)
                const nextTime = lastTime + 3600;
                const open = lastClose;
                const volatility = 60;
                const change = (Math.random() - 0.5) * volatility * 3;
                const close = open + change;
                
                let high = Math.max(open, close) + Math.random() * (volatility * 0.5);
                let low = Math.min(open, close) - Math.random() * (volatility * 0.5);

                const newCandle = {
                    time: nextTime,
                    open: parseFloat(open.toFixed(2)),
                    high: parseFloat(high.toFixed(2)),
                    low: parseFloat(low.toFixed(2)),
                    close: parseFloat(close.toFixed(2)),
                };

                const newVolume = {
                    time: nextTime,
                    value: Math.random() * 1000 + 500,
                    color: close > open ? 'rgba(34, 197, 94, 0.4)' : 'rgba(239, 68, 68, 0.4)',
                };

                // Mise à jour sécurisée
                if(validateCandle(newCandle) && candleSeries) {
                    candleSeries.update(newCandle);
                    if (volumeSeries) volumeSeries.update(newVolume);
                    
                    // Mise à jour des variables d'état
                    lastClose = close;
                    lastTime = nextTime;

                    // Mise à jour du prix dans la Sidebar avec animation couleur
                    if(btcPriceEl) {
                        btcPriceEl.innerText = close.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                        btcPriceEl.className = `text-xs font-mono font-medium transition-colors duration-300 ${change >= 0 ? 'text-green-400' : 'text-red-400'}`;
                        // Reset couleur après 1s
                        setTimeout(() => {
                            if(btcPriceEl) btcPriceEl.className = 'text-white font-mono text-xs font-medium transition-colors duration-500';
                        }, 800);
                    }
                }
            }, 2000); // Tick toutes les 2 secondes
        }
    </script>
</body>
</html>
